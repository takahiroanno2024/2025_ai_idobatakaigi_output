
![ローカル開発環境構築ガイド](https://github.com/Sunwood-ai-labs/election2024/assets/108736814/04610ae4-805e-474a-a656-c4153136e644)

# ローカル開発環境構築ガイド

## 1. はじめに

このガイドでは、「安野たかひろ：都知事選マニフェスト」プロジェクトの内部機能をローカル環境に再現し、効率的に開発できるようにするための手順を詳細に説明します。初心者の方でも理解しやすいよう、各ステップを丁寧に解説していきます。

## 2. 前提条件

このガイドを進める前に、以下のソフトウェアがインストールされていることを確認してください：

- Git（[Windowsユーザーの方はこちら](https://git-scm.com/download/win)）
- Python 3.8以上（[Minicondaがおすすめ](https://docs.anaconda.com/miniconda/)）
- pip（Pythonパッケージマネージャー）

これらのツールがインストールされていない場合は、各公式サイトからダウンロードしてインストールしてください。

## 3. リポジトリのクローン

まず、プロジェクトのソースコードをローカルマシンにダウンロードします。

### 3.1 リポジトリのフォーク（推奨）

プロジェクトの開発を始める前に、リポジトリをフォークすることをお勧めします。フォークには以下のような利点があります：

1. 独立した作業環境：
   - 元のリポジトリに影響を与えることなく、自由に変更を加えられます。
   - 実験的な機能の追加や、大きな変更を安全に試すことができます。

2. プルリクエストの作成が容易：
   - フォークしたリポジトリから元のリポジトリへプルリクエストを簡単に作成できます。
   - これにより、コードレビューのプロセスがスムーズになります。

3. コントリビューションの管理：
   - 自分の貢献を明確に追跡し、管理することができます。
   - 他の開発者との協力がしやすくなります。

4. 最新の状態との同期：
   - 元のリポジトリの変更を自分のフォークに簡単に取り込むことができます。

フォークの手順：

1. GitHubで元のリポジトリページにアクセスします。
2. 右上の「Fork」ボタンをクリックします。
3. 必要に応じて、フォーク先の組織やリポジトリ名を選択します。
4. 「Create fork」をクリックして、フォークを作成します。

フォーク後のクローン：

フォークしたリポジトリをローカルにクローンします：

```
git clone https://github.com/yourusername/election2024.git
cd election2024
```

>[!NOTE] 
>`yourusername`は実際のGitHubユーザー名に置き換えてください。


フォークしたリポジトリで作業を進め、準備ができたら元のリポジトリにプルリクエストを作成して貢献することができます。

### 3.2 リポジトリのクローン

1. コマンドプロンプトまたはターミナルを開きます。

2. 以下のコマンドを実行して、プロジェクトをクローンします：

   ```
   git clone https://github.com/yourusername/election2024.git
   ```

>[!NOTE] 
>`yourusername`の部分は、実際のGitHubユーザー名またはプロジェクトの所有者名に置き換えてください。

3. クローンしたディレクトリに移動します：

   ```
   cd election2024
   ```

## 4. 開発環境の準備

次に、プロジェクトの開発に必要な環境を整えます。

### 4.1 必要なスクリプトへのアクセス

1. `.github/scripts/`ディレクトリに移動します：

   ```
   cd .github/scripts/
   ```

>[!NOTE] 
>以降の操作は、すべてこの`.github/scripts/`ディレクトリ内で行います。

### 4.2 環境変数の設定

プロジェクトでは、セキュリティのために重要な情報を環境変数として管理しています。

1. サンプルの環境変数ファイルをコピーします：

   ```
   cp .env.example .env
   ```

2. テキストエディタで`.env`ファイルを開きます。

3. 以下の環境変数を適切な値で設定します：

   - `QD_API_KEY`: QdrantのAPIキー
   - `OPENAI_API_KEY`: OpenAIのAPIキー
   - `QD_URL`: QdrantのURL
   - `GITHUB_EVENT_ISSUE_NUMBER`: デバッグ用のIssue番号
   - `GITHUB_REPOSITORY`: あなたのGitHubリポジトリ（例：`username/repo`）
   - `GITHUB_TOKEN`: GitHubの個人アクセストークン

>[!NOTE] 
>これらの値は、各サービスの管理画面やドキュメントを参照して取得してください。個人情報やAPIキーは絶対に公開しないようご注意ください。


### 4.3 Qdrantについて

Qdrantは、このプロジェクトで使用されているベクトルデータベースです。テキストデータを数値ベクトルとして保存し、高速に類似検索を行うことができます。

#### Qdrantの概要
- Qdrantは高性能なベクトル類似性検索エンジンです。
- テキストデータ（この場合、政策提案）をベクトル化して保存し、効率的に検索できます。
- 類似した政策の検索や、カテゴリ別のフィルタリングが可能です。

#### QdrantのAPIキーとURLの取得手順

1. Qdrantのウェブサイト（https://qdrant.tech/）にアクセスし、アカウントを作成またはログインします。

2. ダッシュボードから新しいクラスターを作成します。
   - 無料プランを選択すると、開発用の小規模なクラスターを利用できます。

3. クラスターが作成されたら、「Connection Details」セクションを見つけます。

4. 以下の情報をメモします：
   - `QD_URL`: 「Cluster URL」の値
   - `QD_API_KEY`: 「API Key」の値

5. これらの値を`.env`ファイルの対応する箇所に設定します。

>[!NOTE] 
>APIキーは秘密情報です。GitHub等の公開リポジトリにアップロードしたり、他人と共有したりしないでください。

### 4.4 Qdrantの初期化

Qdrantを使用する前に、適切なコレクションを作成し初期化する必要があります。以下の手順に従ってQdrantを初期化してください。

1. `.github/developer/`ディレクトリに移動します：

   ```
   cd .github/developer/
   ```

2. `initialize_qdrant_collection.py`スクリプトを実行します：

   ```
   python initialize_qdrant_collection.py
   ```

   このスクリプトは以下の操作を行います：
   - Qdrantサーバーへの接続
   - 既存のコレクションの一覧表示
   - "issue_collection"という名前の新しいコレクションの作成（既に存在しない場合）
   - 作成されたコレクションの詳細情報の取得

3. スクリプトの出力を確認し、以下の点に注意してください：
   - APIキーが正しく読み込まれているか（最初と最後の5文字が表示されます）
   - Qdrantサーバーに正常に接続できているか
   - "issue_collection"が正常に作成されたか、または既に存在しているか
   - エラーメッセージが表示された場合は、エラーの内容を確認し対処してください

>[!NOTE] 
>`このスクリプトはプロジェクトの`.env`ファイルから環境変数を読み込みます。`.env`ファイルが正しく設定されていることを確認してください。

初期化が成功すると、Qdrantコレクションが利用可能になり、プロジェクトで使用できるようになります。


## 5. 依存ライブラリのインストール

プロジェクトで使用している外部ライブラリをインストールします。

1. `.github/scripts/`ディレクトリにいることを確認してから、以下のコマンドを実行します：

   ```
   pip install -r ../requirements.txt
   ```

   このコマンドは、`requirements.txt`ファイルに記載されているすべての必要なライブラリをインストールします。

## 6. デバッグの実行

これで環境の準備が整いました。実際にスクリプトを実行してデバッグを行います。

1. `review_issue.py`スクリプトを実行します：

   ```
   python review_issue.py
   ```

2. スクリプトの出力を確認し、エラーや警告がないかチェックします。

## 7. トラブルシューティング

デバッグ中に問題が発生した場合は、以下の点を確認してください：

### 7.1 API接続エラー

- `.env`ファイルの認証情報（APIキーやURL）が正しいか確認します。
- インターネット接続が安定しているか確認します。

### 7.2 GitHubのレート制限

GitHubのAPI使用回数制限に達した場合：

- しばらく時間を置いてから再試行します。
- GitHubの個人アクセストークンを使用している場合、より高いレート制限が適用されます。

### 7.3 Qdrantの操作エラー

- Qdrantのコレクションが正しく初期化されているか確認します。
- QdrantのURLとAPIキーが正しいか再確認します。

## 8. テスト用Issueの作成

実際のGitHub Issueを使ってテストしたい場合は、以下の手順に従ってください：

1. GitHubのプロジェクトページに移動し、新しいIssueを作成します。

2. 作成したIssueの番号（URLの最後の数字）をメモします。

3. `.env`ファイルを開き、`GITHUB_EVENT_ISSUE_NUMBER`にメモした番号を設定します。

4. `.github/scripts/`ディレクトリにいることを確認し、再度スクリプトを実行します：

   ```
   python review_issue.py
   ```

5. スクリプトの実行後、GitHubのIssueページを確認し、正しく処理されたか確認します。

>[!NOTE] 
>テスト用のIssueを作成する際は、実際の運用環境に影響を与えないよう注意してください。

## 9. まとめ

以上の手順で、「安野たかひろ：都知事選マニフェスト」プロジェクトのローカル開発環境を構築し、デバッグを行うことができます。問題が発生した場合は、このガイドのトラブルシューティングセクションを参照するか、プロジェクトの管理者に連絡してサポートを受けてください。

開発を進める際は、常にセキュリティに注意し、機密情報を誤って公開しないよう気をつけてください。また、定期的にリポジトリの更新をチェックし、最新の状態を保つことをお勧めします。
